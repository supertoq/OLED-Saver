id: free.basti.oledsaver
runtime: org.gnome.Platform
runtime-version: "49"
sdk: org.gnome.Sdk
command: oled-saver

finish-args:
  - --socket=fallback-x11
  - --socket=wayland
  - --filesystem=host
  - --socket=system-bus
  - --talk-name=org.freedesktop.login1
  - --talk-name=org.freedesktop.ScreenSaver
  - --share=network
  - --device=dri

modules:
  - name: oled-saver
    buildsystem: simple
    build-commands:
      - mkdir -p _build/bin _build/share/applications _build/share/icons/hicolor/scalable/apps _build/share/icons/hicolor/128x128/apps
      - gcc $(pkg-config --cflags gtk4 libadwaita-1 dbus-1) -o _build/bin/oled-saver src/main.c src/free.basti.oledsaver.gresource.c $(pkg-config --libs gtk4 libadwaita-1 dbus-1)
      - install -D -m 0755 _build/bin/oled-saver /app/bin/oled-saver
      - install -D -m 0644 packaging/free.basti.oledsaver.desktop /app/share/applications/free.basti.oledsaver.desktop
      - install -D -m 0644 packaging/free.basti.oledsaver.svg /app/share/icons/hicolor/scalable/apps/free.basti.oledsaver.png
      - install -D -m 0644 packaging/free.basti.oledsaver.png /app/share/icons/hicolor/128x128/apps/free.basti.oledsaver.png
      - install -D -m 0644 packaging/free.basti.oledsaver.metainfo.xml /app/share/metainfo/free.basti.oledsaver.metainfo.xml
      - install -D -m 0644 packaging/oledsaver_preview_img1.png /app/share/screenshots/oledsaver_preview_img1.png 
    sources:
      - type: dir
        path: .
